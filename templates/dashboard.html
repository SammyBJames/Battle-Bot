{% extends "base.html" %}

{% block title %}Battle Bot - Dashboard{% endblock %}

{% block content %}
<div class="grid gap-6">
    <div class="flex items-center justify-between">
        <h2 class="text-3xl font-bold tracking-tight">Dashboard</h2>
        <div class="flex items-center space-x-2">
            <span class="text-sm text-muted-foreground">Logged in as <strong class="text-foreground">{{ user.username }}</strong> ({{ user.role }})</span>
            <a href="{{ url_for('logout') }}" class="inline-flex h-9 items-center justify-center rounded-md border border-input bg-transparent px-4 py-2 text-sm font-medium shadow-sm ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50">
                Logout
            </a>
        </div>
    </div>
    <div class="rounded-xl border border-border bg-card text-card-foreground shadow-sm">
        <div class="flex flex-col space-y-1.5 p-6">
            <h3 class="font-semibold leading-none tracking-tight text-xl">Item Database</h3>
            <p class="text-sm text-muted-foreground">Search for available robot modules</p>
        </div>
        <div class="p-6 pt-0">
            {% if search_enabled %}
                <form id="search-form" action="{{ url_for('search') }}" method="get" class="flex w-full max-w-sm items-center space-x-2 mb-4">
                    <input type="text" name="q" placeholder="Search items..." class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
                    <button type="submit" class="inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        Search
                    </button>
                </form>

                <div id="results-container" class="rounded-md border border-border {% if not results %}hidden{% endif %}">
                    <table class="w-full caption-bottom text-sm text-left">
                        <thead class="[&_tr]:border-b">
                            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                <th class="h-12 px-4 align-middle font-medium text-muted-foreground">ID</th>
                                <th class="h-12 px-4 align-middle font-medium text-muted-foreground">Name</th>
                                <th class="h-12 px-4 align-middle font-medium text-muted-foreground">Description</th>
                                <th class="h-12 px-4 align-middle font-medium text-muted-foreground">Category</th>
                            </tr>
                        </thead>
                        <tbody id="results-body" class="[&_tr:last-child]:border-0"></tbody>
                    </table>
                </div>
            {% else %}
                <div class="rounded-md bg-secondary p-4 text-center">
                    <p class="text-sm text-muted-foreground">
                        Search functionality is currently <strong>disabled</strong> for maintenance.
                        <br>
                        <span class="text-xs opacity-50">Please check back later.</span>
                    </p>
                </div>
            {% endif %}
        </div>
    </div>

    {% if user.role == 'admin' %}
    <div class="grid gap-6 md:grid-cols-2">
        <div class="rounded-xl border border-border bg-card text-card-foreground shadow-sm">
            <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="font-semibold leading-none tracking-tight text-xl text-destructive">Admin Control Panel</h3>
                <p class="text-sm text-muted-foreground">Manual override</p>
            </div>
            <div class="p-6 pt-0">
                <div class="robot-controls flex flex-col items-center justify-center gap-4 py-4">
                    <!-- Up -->
                    <form action="{{ url_for('move_robot') }}" method="post" data-direction="forward">
                        <input type="hidden" name="direction" value="forward">
                        <button class="h-12 w-12 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground flex items-center justify-center shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 15-6-6-6 6"/></svg>
                        </button>
                    </form>
                    
                    <div class="flex gap-4">
                        <!-- Left -->
                        <form action="{{ url_for('move_robot') }}" method="post" data-direction="left">
                            <input type="hidden" name="direction" value="left">
                            <button class="h-12 w-12 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground flex items-center justify-center shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                            </button>
                        </form>
                        
                        <!-- Down -->
                        <form action="{{ url_for('move_robot') }}" method="post" data-direction="backward">
                             <input type="hidden" name="direction" value="backward">
                             <button class="h-12 w-12 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground flex items-center justify-center shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                            </button>
                        </form>
    
                        <!-- Right -->
                        <form action="{{ url_for('move_robot') }}" method="post" data-direction="right">
                            <input type="hidden" name="direction" value="right">
                            <button class="h-12 w-12 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground flex items-center justify-center shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="rounded-xl border border-border bg-card text-card-foreground shadow-sm">
            <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="font-semibold leading-none tracking-tight text-xl">Operation Log</h3>
                <p class="text-sm text-muted-foreground">Manual override history</p>
            </div>
            <div class="p-1 pt-0">
                <div class="rounded-md bg-muted/30 p-4 h-[200px] overflow-y-auto">
                    <div id="robot-log" class="flex flex-col space-y-2 text-xs font-mono">
                        <div class="text-muted-foreground italic">Ready...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
